apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Reference the base configuration
resources:
  - ../../base

# Namespace for production
namespace: waveforge-prod

# Environment-specific labels
commonLabels:
  environment: production
  tier: production

# Patch the deployment for production settings
patchesStrategicMerge:
  - deployment-patch.yaml
  - ingress-patch.yaml
  - pvc-patch.yaml
  - hpa-patch.yaml

# ConfigMap with production-specific settings
configMapGenerator:
  - name: app-config
    behavior: merge
    literals:
      - ENVIRONMENT=production
      - LOG_LEVEL=warning
      - DEBUG=false
      - CORS_ORIGINS=https://waveforge-pro.example.com,https://www.waveforge-pro.example.com
      - MAX_UPLOAD_SIZE=209715200
      - CHUNK_SIZE=4194304
      - ENABLE_ANALYTICS=true
      - ENABLE_MONITORING=true
      - ENABLE_RATE_LIMITING=true
      - PROTOCOL=https
      - FORCE_HTTPS=true
      - HSTS_ENABLED=true

# Replicas for production (high availability)
replicas:
  - name: waveforge-pro
    count: 3

# Use production image tag (semantic versioning)
images:
  - name: waveforge-pro
    newName: waveforge-pro
    newTag: v1.0.0

# Name prefix for production resources
namePrefix: prod-

# Add production-specific annotations
commonAnnotations:
  environment: production
  monitoring: "enabled"
  backup: "enabled"
  alerting: "enabled"
  sla: "99.9"
